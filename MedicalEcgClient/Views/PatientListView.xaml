<UserControl x:Class="MedicalEcgClient.Views.PatientListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:MedicalEcgClient.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006">
    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal">
                <TextBlock Text="&#xE721;" FontFamily="Segoe MDL2 Assets" 
                           VerticalAlignment="Center" FontSize="16" Margin="0,0,10,0" Foreground="Gray"/>
                <TextBox Text="{Binding SearchKeyword, UpdateSourceTrigger=PropertyChanged}" 
                         Width="300" Height="35" VerticalContentAlignment="Center" Padding="5"
                         Tag="Tìm kiếm theo tên hoặc mã hồ sơ..."/>
                <Button Command="{Binding RefreshCommand}" Margin="10,0" Padding="10,5" Background="White" BorderBrush="#DDD">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" Margin="0,0,5,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Làm mới"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Command="{Binding OpenEditPatientCommand}" 
                        Visibility="{Binding SelectedPatient, Converter={StaticResource BoolToVis}}"
                        Background="#FFC107" Foreground="Black" Padding="15,8" Margin="0,0,10,0" FontWeight="Bold" BorderThickness="0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE70F;" FontFamily="Segoe MDL2 Assets" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Sửa / Xóa"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding OpenAddPatientCommand}" 
                        Background="#198754" Foreground="White" Padding="15,8" FontWeight="Bold" BorderThickness="0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Tiếp Nhận Mới"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <DataGrid Grid.Row="1" ItemsSource="{Binding Patients}" SelectedItem="{Binding SelectedPatient}"
                  AutoGenerateColumns="False" IsReadOnly="True" 
                  HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                  BorderThickness="0" Margin="20,0" SelectionMode="Single">

            <DataGrid.InputBindings>
                <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding OpenEditPatientCommand}" />
            </DataGrid.InputBindings>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Mã HS" Binding="{Binding PatientCode}" Width="100" FontWeight="Bold"/>
                <DataGridTextColumn Header="Họ và Tên" Binding="{Binding FullName}" Width="*"/>
                <DataGridTextColumn Header="Ngày sinh" Binding="{Binding DateOfBirth, StringFormat='dd/MM/yyyy'}" Width="100"/>
                <DataGridTextColumn Header="Giới tính" Binding="{Binding Gender}" Width="80"/>

                <DataGridTextColumn Header="Trạng thái" Binding="{Binding Status}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="Chờ khám">
                                    <Setter Property="Foreground" Value="#FF9800"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Đã khám">
                                    <Setter Property="Foreground" Value="#2E7D32"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="2" Background="#F8F9FA" Padding="20" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="Chọn bệnh nhân để thao tác:" VerticalAlignment="Center" Margin="0,0,15,0" FontStyle="Italic" Foreground="Gray"/>
                <Button Command="{Binding GoToEcgCommand}" 
                        Height="45" Padding="20,0" Margin="5,0" BorderThickness="0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#0D6EFD"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="IsEnabled" Value="True"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedPatient}" Value="{x:Null}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                    <Setter Property="Background" Value="#E0E0E0"/>
                                    <Setter Property="Foreground" Value="#A0A0A0"/>
                                    <Setter Property="Cursor" Value="Arrow"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE77B;" FontFamily="Segoe MDL2 Assets" FontSize="18" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="XEM HỒ SƠ &amp; KHÁM MỚI" FontWeight="Bold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <Grid Grid.RowSpan="3" Background="#AA000000" Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}">
            <Border Background="White" Width="500" VerticalAlignment="Center" CornerRadius="8" Padding="20">
                <StackPanel>
                    <Grid Margin="0,0,0,20">
                        <TextBlock Text="{Binding EditorTitle}" FontSize="18" FontWeight="Bold" Foreground="#0D6EFD" VerticalAlignment="Center"/>
                        <Button Command="{Binding DeletePatientCommand}" 
                                Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}"
                                HorizontalAlignment="Right" Background="Transparent" Foreground="Red" BorderBrush="Red" BorderThickness="1" Padding="10,5">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Xóa Bệnh Nhân"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <TextBlock Text="Mã Hồ Sơ (Tự động)" Foreground="Gray" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding EditingPatient.PatientCode}" IsReadOnly="True" Background="#F0F0F0" Padding="5" Margin="0,0,0,10"/>

                    <TextBlock Text="Họ và Tên (*)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding EditingPatient.FullName}" Padding="5" Height="30" Margin="0,0,0,10"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Margin="0,0,5,0">
                            <TextBlock Text="Ngày sinh" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding EditingPatient.DateOfBirth}" Height="30" VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="5,0,0,0">
                            <TextBlock Text="Giới tính" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox SelectedValue="{Binding EditingPatient.Gender}" SelectedValuePath="Content" Padding="5" Height="30">
                                <ComboBoxItem Content="Nam"/>
                                <ComboBoxItem Content="Nữ"/>
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Trạng thái" FontWeight="SemiBold" Margin="0,10,0,5"/>
                    <ComboBox SelectedValue="{Binding EditingPatient.Status}" SelectedValuePath="Content" Padding="5" Height="30">
                        <ComboBoxItem Content="Waiting"/>
                        <ComboBoxItem Content="Examining"/>
                        <ComboBoxItem Content="Done"/>
                    </ComboBox>

                    <TextBlock Text="Ghi chú / Lưu ý đặc biệt" FontWeight="SemiBold" Margin="0,10,0,5"/>
                    <TextBox Text="{Binding EditingPatient.Note}" Height="60" TextWrapping="Wrap" 
                             Padding="5" VerticalContentAlignment="Top" AcceptsReturn="True" ScrollViewer.VerticalScrollBarVisibility="Auto"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Command="{Binding CancelEditCommand}" Width="100" Height="35" Margin="0,0,10,0" Background="#DDD" BorderThickness="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Hủy bỏ"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding SavePatientCommand}" Width="140" Height="35" Background="#198754" Foreground="White" FontWeight="Bold" BorderThickness="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                <TextBlock Text="LƯU THÔNG TIN"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>